<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mekane Heywet File Browser</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-dark: #1a1a2e;
            --background-gradient: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #1a1a2e);
            --card-bg: rgba(55, 65, 81, 0.7);
            --text-light: #ffffff;
            --text-muted: #b0b0b0;
            --error-color: #e74c3c;
            --success-color: #2ecc71;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--background-gradient);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: var(--text-light);
            min-height: 100vh;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-group {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: var(--text-light);
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .circle-logo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--secondary-color);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .circle-logo:hover {
            transform: scale(1.05);
        }

        .auth-section {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto 30px;
            animation: slideUp 0.8s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-section h2 {
            color: var(--secondary-color);
            margin-top: 0;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }

        input[type="password"]:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: all 0.3s;
            font-weight: bold;
        }

        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .error-message {
            color: var(--error-color);
            margin-top: 10px;
            text-align: center;
            font-size: 14px;
        }

        .file-browser {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            animation: fadeIn 0.8s ease;
            display: none;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            padding: 10px 0;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
            margin: 0 5px;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #a0d4f8;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: var(--text-muted);
            margin: 0 5px;
        }

        .file-list-container {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
        }

        .file-list-container::-webkit-scrollbar {
            width: 8px;
        }

        .file-list-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .file-list-container::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 10px;
        }

        .file-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: background-color 0.2s;
        }

        .file-item:hover {
            background-color: rgba(15, 52, 96, 0.5);
            cursor: pointer;
        }

        .file-icon {
            margin-right: 15px;
            font-size: 20px;
            width: 24px;
            text-align: center;
            color: var(--primary-color);
        }

        .file-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-size: 16px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-details {
            display: flex;
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 3px;
        }

        .file-size {
            margin-right: 15px;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .file-action-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .file-action-btn:hover {
            background-color: rgba(255,255,255,0.1);
            transform: scale(1.1);
        }

        .view-btn { color: var(--success-color); }
        .download-btn { color: var(--primary-color); }

        .loading {
            text-align: center;
            padding: 30px;
            font-size: 18px;
            color: var(--text-muted);
            display: none;
        }

        .empty-folder {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
            font-style: italic;
        }

        .status-bar {
            margin-top: 20px;
            padding: 10px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 4px;
            font-size: 14px;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
        }

        /* Responsive design */
        @media (max-width: 768px) {
    .container {
        padding: 15px;
    }

    h1 {
        font-size: 1.8rem;
    }

    .file-item {
        display: flex;
        flex-direction: row; /* Keep items in a row */
        align-items: center; /* Center items vertically */
        padding: 10px 5px; /* Reduce padding */
        overflow-x: auto; /* Allow horizontal scrolling if needed */
        white-space: nowrap; /* Prevent wrapping */
    }

    .file-icon {
        margin-right: 8px; /* Reduce margin */
        font-size: 16px; /* Smaller icon */
    }

    .file-name {
        font-size: 14px; /* Smaller font */
        max-width: 120px; /* Limit width */
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .file-details {
        font-size: 11px; /* Smaller details */
        flex-direction: column; /* Stack size and type */
    }

    .file-actions {
        margin-top: 0; /* Remove top margin */
        gap: 5px; /* Reduce gap between buttons */
    }

    .file-action-btn {
        font-size: 14px; /* Smaller buttons */
        width: 28px;
        height: 28px;
    }

    /* Adjust breadcrumb for mobile */
    .breadcrumb {
        font-size: 14px;
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 5px;
    }

    /* Hide some breadcrumb items if needed */
    .breadcrumb a:not(:last-child):not(:first-child) {
        display: none;
    }

    .breadcrumb-separator {
        margin: 0 3px;
    }

    /* Add ellipsis for middle items */
    .breadcrumb a:first-child + .breadcrumb-separator + a {
        display: inline-block;
        max-width: 60px;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: bottom;
    }
}

        /* Animation for file items */
        @keyframes fadeInItem {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .file-item {
            animation: fadeInItem 0.3s ease forwards;
            opacity: 0;
        }

        .file-item:nth-child(1) { animation-delay: 0.1s; }
        .file-item:nth-child(2) { animation-delay: 0.2s; }
        .file-item:nth-child(3) { animation-delay: 0.3s; }
        .file-item:nth-child(4) { animation-delay: 0.4s; }
        .file-item:nth-child(5) { animation-delay: 0.5s; }
        .file-item:nth-child(n+6) { animation-delay: 0.6s; }

        /* Modal for file preview */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 10px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            padding: 20px;
            position: relative;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: var(--text-light);
            cursor: pointer;
            background: none;
            border: none;
        }

        .file-preview {
            max-width: 100%;
            max-height: 80vh;
            display: block;
            margin: 0 auto;
        }

        .audio-player {
            width: 100%;
            margin-top: 20px;
        }

        .unsupported-file {
            padding: 30px;
            text-align: center;
            color: var(--text-light);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-group">
            <h1>መካነሕይወት አብነት ትምሕርት</h1>
            <img src="logo.png" alt="Mekane Heywet Logo" class="circle-logo">
        </div>

        <div id="authSection" class="auth-section">
            <h2>Authentication Required</h2>
            <div class="form-group">
                <input type="password" id="passwordInput" placeholder="Enter password" autocomplete="current-password">
            </div>
            <button id="loginButton">Login</button>
            <div id="errorMessage" class="error-message"></div>
        </div>

        <div id="fileBrowser" class="file-browser">
            <div class="breadcrumb" id="breadcrumb">
                <a href="#" class="go-to-root">Root</a>
            </div>

            <div id="loadingIndicator" class="loading">
                <i class="fas fa-spinner fa-spin"></i> Loading files...
            </div>

            <div class="file-list-container">
                <ul class="file-list" id="fileList"></ul>
                <div id="emptyFolder" class="empty-folder" style="display: none;">
                    This folder is empty
                </div>
            </div>

            <div class="status-bar">
                <span id="itemCount">0 items</span>
                <span id="storageInfo">-</span>
            </div>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // DOM Elements
        const authSection = document.getElementById('authSection');
        const fileBrowser = document.getElementById('fileBrowser');
        const passwordInput = document.getElementById('passwordInput');
        const loginButton = document.getElementById('loginButton');
        const errorMessage = document.getElementById('errorMessage');
        const breadcrumb = document.getElementById('breadcrumb');
        const fileList = document.getElementById('fileList');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const emptyFolder = document.getElementById('emptyFolder');
        const itemCount = document.getElementById('itemCount');
        const storageInfo = document.getElementById('storageInfo');
        const previewModal = document.getElementById('previewModal');
        const modalContent = document.getElementById('modalContent');
        const closeModal = document.querySelector('.close-modal');

        // State management
        let currentPath = [];
        let fileCache = {};

        // Event Listeners
        loginButton.addEventListener('click', handleLogin);
        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleLogin();
        });
        closeModal.addEventListener('click', () => {
            previewModal.style.display = 'none';
        });
        window.addEventListener('click', (e) => {
            if (e.target === previewModal) {
                previewModal.style.display = 'none';
            }
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
            setupServiceWorker();
        });

        // Check authentication status
        async function checkAuthStatus() {
            try {
                const response = await fetch('/api/check-auth', {
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.authenticated) {
                        showFileBrowser();
                        loadFolderContents([]);
                    }
                }
            } catch (error) {
                console.error('Auth check failed:', error);
            }
        }

        // Handle login
        async function handleLogin() {
            const password = passwordInput.value.trim();

            if (!password) {
                showError('Please enter a password');
                return;
            }

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password }),
                    credentials: 'include'
                });

                if (response.ok) {
                    showFileBrowser();
                    loadFolderContents([]);
                } else {
                    const errorData = await response.json();
                    showError(errorData.error || 'Invalid password');
                }
            } catch (error) {
                showError('Login failed. Please try again.');
                console.error('Login error:', error);
            }
        }

        // Show file browser after successful auth
        function showFileBrowser() {
            authSection.style.display = 'none';
            fileBrowser.style.display = 'block';
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.opacity = '0';
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                    errorMessage.style.opacity = '1';
                }, 300);
            }, 3000);
        }

        // Load folder contents
        async function loadFolderContents(path) {
            currentPath = path;
            updateBreadcrumb();
            fileList.innerHTML = '';
            loadingIndicator.style.display = 'block';
            emptyFolder.style.display = 'none';

            const pathKey = path.join('/') || 'root';

            // Check cache first
            if (fileCache[pathKey]) {
                displayFiles(fileCache[pathKey]);
                return;
            }

            try {
                const pathStr = path.join('/');
                const response = await fetch(`/api/list?path=${encodeURIComponent(pathStr)}`, {
                    credentials: 'include'
                });

                if (!response.ok) {
                    throw new Error(await response.text());
                }

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                // Cache the results
                fileCache[pathKey] = data;

                displayFiles(data);
                updateStatusBar(data.folders.length + data.files.length);
            } catch (error) {
                console.error('Error loading folder:', error);
                fileList.innerHTML = `
                    <li class="file-item" style="color: #e74c3c;">
                        <i class="file-icon fas fa-exclamation-circle"></i>
                        <div class="file-info">
                            <div class="file-name">Error loading folder</div>
                            <div class="file-details">${error.message}</div>
                        </div>
                    </li>
                `;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        // Display files and folders
        function displayFiles(data) {
            fileList.innerHTML = '';

            // Add "Back" button if not at root
            if (currentPath.length > 0) {
                const backItem = document.createElement('li');
                backItem.className = 'file-item';
                backItem.innerHTML = `
                    <i class="file-icon fas fa-arrow-left"></i>
                    <div class="file-info">
                        <div class="file-name">Go Back</div>
                        <div class="file-details">Parent directory</div>
                    </div>
                `;
                backItem.addEventListener('click', () => {
                    loadFolderContents(currentPath.slice(0, -1));
                });
                fileList.appendChild(backItem);
            }

            // Add folders
            data.folders.forEach((folder, index) => {
                const folderItem = createFolderItem(folder, index);
                fileList.appendChild(folderItem);
            });

            // Add files
            data.files.forEach((file, index) => {
                const fileItem = createFileItem(file, index);
                fileList.appendChild(fileItem);
            });

            // Show empty folder message if needed
            if (data.folders.length === 0 && data.files.length === 0 && currentPath.length === 0) {
                emptyFolder.style.display = 'block';
            }
        }

        // Create folder list item
        function createFolderItem(folder, index) {
            const folderItem = document.createElement('li');
            folderItem.className = 'file-item';
            folderItem.style.animationDelay = `${0.1 + (index * 0.05)}s`;

            folderItem.innerHTML = `
                <i class="file-icon fas fa-folder"></i>
                <div class="file-info">
                    <div class="file-name">${folder}</div>
                    <div class="file-details">Folder</div>
                </div>
            `;

            folderItem.addEventListener('click', () => {
                loadFolderContents([...currentPath, folder]);
            });

            return folderItem;
        }

        // Create file list item
        function createFileItem(file, index) {
            const fileItem = document.createElement('li');
            fileItem.className = 'file-item';
            fileItem.style.animationDelay = `${0.1 + (index * 0.05)}s`;

            const fileExt = file.name.split('.').pop().toLowerCase();
            const fileIcon = getFileIcon(fileExt);
            const fileType = getFileType(fileExt);
            const fileSize = formatFileSize(file.size);
            const filePath = [...currentPath, file.name].join('/');

            fileItem.innerHTML = `
                <i class="file-icon ${fileIcon.icon}"></i>
                <div class="file-info">
                    <div class="file-name">${file.name}</div>
                    <div class="file-details">
                        <span class="file-size">${fileSize}</span>
                        <span class="file-type">${fileType}</span>
                    </div>
                </div>
                <div class="file-actions">
                    <button class="file-action-btn view-btn" data-path="${encodeURIComponent(filePath)}" title="View">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="file-action-btn download-btn" data-path="${encodeURIComponent(filePath)}" title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            `;

            // Add event listeners for actions
            fileItem.querySelector('.view-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                handleFileAction(filePath, fileExt, 'view');
            });

            fileItem.querySelector('.download-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                handleFileAction(filePath, fileExt, 'download');
            });

            // Click on the item itself (for folders)
            fileItem.addEventListener('click', (e) => {
                if (!e.target.closest('.file-actions')) {
                    handleFileAction(filePath, fileExt, 'view');
                }
            });

            return fileItem;
        }

        // Handle file actions (view or download)
        function handleFileAction(filePath, fileExt, action) {
            if (action === 'view' && isPreviewable(fileExt)) {
                if (isAudioFile(fileExt)) {
                    openAudioInNewTab(filePath);
                } else {
                    previewFile(filePath, fileExt);
                }
            } else {
                downloadFile(filePath);
            }
        }

        // Check if file is audio
        function isAudioFile(extension) {
            const audioExtensions = ['mp3', 'wav', 'ogg', 'flac', 'm4a'];
            return audioExtensions.includes(extension);
        }

        // Open audio in new tab
        function openAudioInNewTab(filePath) {
            const audioWindow = window.open('', '_blank');
            audioWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Audio Player</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            text-align: center;
                            padding: 20px;
                            background-color: #1a1a2e;
                            color: white;
                        }
                        .player-container {
                            max-width: 400px;
                            margin: 0 auto;
                            background: rgba(55, 65, 81, 0.7);
                            padding: 20px;
                            border-radius: 8px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                        }
                        audio {
                            width: 100%;
                            margin: 20px 0;
                            background-color: #2c3e50;
                            border-radius: 20px;
                            padding: 10px;
                        }
                        h2 { color: #3498db; }
                        .filename {
                            margin-top: 10px;
                            color: #b0b0b0;
                            word-break: break-all;
                        }
                    </style>
                </head>
                <body>
                    <div class="player-container">
                        <h2>Audio Player</h2>
                        <audio controls autoplay>
                            <source src="/api/view?path=${encodeURIComponent(filePath)}" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                        <div class="filename">${filePath.split('/').pop()}</div>
                    </div>
                </body>
                </html>
            `);
            audioWindow.document.close();
        }

        // Preview a file
        function previewFile(filePath, fileExt) {
            if (!isPreviewable(fileExt)) {
                downloadFile(filePath);
                return;
            }

            loadingIndicator.style.display = 'block';
            modalContent.innerHTML = '';
            previewModal.style.display = 'flex';

            fetch(`/api/view?path=${encodeURIComponent(filePath)}`, {
                credentials: 'include'
            })
            .then(response => {
                if (!response.ok) throw new Error('Failed to load file');

                const contentType = response.headers.get('content-type');

                if (contentType.includes('image')) {
                    return response.blob().then(blob => {
                        const url = URL.createObjectURL(blob);
                        modalContent.innerHTML = `<img src="${url}" class="file-preview" alt="Preview">`;
                    });
                } else if (contentType.includes('pdf')) {
                    return response.blob().then(blob => {
                        const url = URL.createObjectURL(blob);
                        modalContent.innerHTML = `
                            <embed src="${url}" type="application/pdf" width="100%" height="600px" class="file-preview">
                        `;
                    });
                } else if (contentType.includes('video')) {
                    return response.blob().then(blob => {
                        const url = URL.createObjectURL(blob);
                        modalContent.innerHTML = `
                            <video controls class="file-preview">
                                <source src="${url}" type="${contentType}">
                                Your browser does not support video playback.
                            </video>
                        `;
                    });
                } else {
                    modalContent.innerHTML = `
                        <div class="unsupported-file">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>This file type cannot be previewed in the browser.</p>
                            <button onclick="downloadFile('${filePath}')" class="download-btn">
                                <i class="fas fa-download"></i> Download File
                            </button>
                        </div>
                    `;
                }
            })
            .catch(error => {
                modalContent.innerHTML = `
                    <div class="unsupported-file">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading file: ${error.message}</p>
                    </div>
                `;
            })
            .finally(() => {
                loadingIndicator.style.display = 'none';
            });
        }

        // Download a file
        function downloadFile(filePath, fileName = '') {
            window.open(`/api/download?path=${encodeURIComponent(filePath)}`, '_blank');
        }

        // Update breadcrumb navigation
        function updateBreadcrumb() {
            breadcrumb.innerHTML = '<a href="#" class="go-to-root"><i class="fas fa-home"></i> Root</a>';

            currentPath.forEach((segment, index) => {
                const separator = document.createElement('span');
                separator.className = 'breadcrumb-separator';
                separator.innerHTML = '<i class="fas fa-chevron-right"></i>';
                breadcrumb.appendChild(separator);

                const link = document.createElement('a');
                link.href = '#';
                link.textContent = segment;
                link.addEventListener('click', () => {
                    loadFolderContents(currentPath.slice(0, index + 1));
                });
                breadcrumb.appendChild(link);
            });

            // Root link event listener
            document.querySelector('.go-to-root').addEventListener('click', (e) => {
                e.preventDefault();
                loadFolderContents([]);
            });
        }

        // Update status bar
        function updateStatusBar(count) {
            itemCount.textContent = `${count} ${count === 1 ? 'item' : 'items'}`;
            // You could add storage usage here if your backend provides it
        }

        // Get appropriate icon for file type
        function getFileIcon(extension) {
            const iconMap = {
                // Documents
                'pdf': { icon: 'fas fa-file-pdf', color: '#e74c3c' },
                'doc': { icon: 'fas fa-file-word', color: '#2c3e50' },
                'docx': { icon: 'fas fa-file-word', color: '#2c3e50' },
                'xls': { icon: 'fas fa-file-excel', color: '#27ae60' },
                'xlsx': { icon: 'fas fa-file-excel', color: '#27ae60' },
                'ppt': { icon: 'fas fa-file-powerpoint', color: '#e67e22' },
                'pptx': { icon: 'fas fa-file-powerpoint', color: '#e67e22' },
                'txt': { icon: 'fas fa-file-alt', color: '#95a5a6' },
                'csv': { icon: 'fas fa-file-csv', color: '#27ae60' },

                // Images
                'jpg': { icon: 'fas fa-file-image', color: '#3498db' },
                'jpeg': { icon: 'fas fa-file-image', color: '#3498db' },
                'png': { icon: 'fas fa-file-image', color: '#3498db' },
                'gif': { icon: 'fas fa-file-image', color: '#3498db' },
                'svg': { icon: 'fas fa-file-image', color: '#3498db' },
                'bmp': { icon: 'fas fa-file-image', color: '#3498db' },

                // Audio
                'mp3': { icon: 'fas fa-file-audio', color: '#9b59b6' },
                'wav': { icon: 'fas fa-file-audio', color: '#9b59b6' },
                'ogg': { icon: 'fas fa-file-audio', color: '#9b59b6' },
                'flac': { icon: 'fas fa-file-audio', color: '#9b59b6' },
                'm4a': { icon: 'fas fa-file-audio', color: '#9b59b6' },

                // Video
                'mp4': { icon: 'fas fa-file-video', color: '#e74c3c' },
                'avi': { icon: 'fas fa-file-video', color: '#e74c3c' },
                'mov': { icon: 'fas fa-file-video', color: '#e74c3c' },
                'wmv': { icon: 'fas fa-file-video', color: '#e74c3c' },
                'flv': { icon: 'fas fa-file-video', color: '#e74c3c' },

                // Archives
                'zip': { icon: 'fas fa-file-archive', color: '#f39c12' },
                'rar': { icon: 'fas fa-file-archive', color: '#f39c12' },
                'tar': { icon: 'fas fa-file-archive', color: '#f39c12' },
                'gz': { icon: 'fas fa-file-archive', color: '#f39c12' },
                '7z': { icon: 'fas fa-file-archive', color: '#f39c12' },

                // Code
                'html': { icon: 'fas fa-file-code', color: '#e67e22' },
                'css': { icon: 'fas fa-file-code', color: '#3498db' },
                'js': { icon: 'fas fa-file-code', color: '#f1c40f' },
                'json': { icon: 'fas fa-file-code', color: '#f1c40f' },
                'py': { icon: 'fas fa-file-code', color: '#3498db' },

                // Default
                'default': { icon: 'fas fa-file', color: '#95a5a6' }
            };

            return iconMap[extension] || iconMap['default'];
        }

        // Get human-readable file type
        function getFileType(extension) {
            const typeMap = {
                'pdf': 'PDF Document',
                'doc': 'Word Document',
                'docx': 'Word Document',
                'xls': 'Excel Spreadsheet',
                'xlsx': 'Excel Spreadsheet',
                'ppt': 'PowerPoint',
                'pptx': 'PowerPoint',
                'txt': 'Text File',
                'jpg': 'JPEG Image',
                'jpeg': 'JPEG Image',
                'png': 'PNG Image',
                'gif': 'GIF Image',
                'mp3': 'Audio File',
                'wav': 'Audio File',
                'mp4': 'Video File',
                'avi': 'Video File',
                'zip': 'ZIP Archive',
                'rar': 'RAR Archive',
                'default': 'File'
            };

            return typeMap[extension] || typeMap['default'];
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0 || !bytes) return '0 Bytes';

            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));

            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Check if file type can be previewed
        function isPreviewable(extension) {
            const previewableTypes = [
                'pdf', 'jpg', 'jpeg', 'png', 'gif',
                'mp3', 'wav', 'ogg', 'flac', 'm4a',
                'mp4', 'avi', 'mov'
            ];
            return previewableTypes.includes(extension);
        }

        // Setup service worker for PWA
        function setupServiceWorker() {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js').then(registration => {
                        console.log('ServiceWorker registration successful');
                    }).catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
                });
            }
        }

        // Expose functions to global scope for modal buttons
        window.downloadFile = downloadFile;
    </script>
</body>
</html>